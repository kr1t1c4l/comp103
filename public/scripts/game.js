$(function(){var k=function(a){h("chat-login",function(b){b.append(f("chat-user",a)).append(" has logged in.")})},m=function(a){h("chat-logout",function(b){b.append(f("chat-user",a)).append(" has logged out.")})},l=function(a,b,c){b=f("chat-text",b);c&&b.addClass("chat-whisper");h("chat-entry",function(c){var d;d=e.find(".chat-user").last();(1!==d.parent().find(".chat-text").length||d.text()!==a)&&c.append(f("chat-user",a)).append(": ");c.append(b)})},f=function(a,b){return $("<span></span>").addClass(a).text(b)},
h=function(a,b){var c;c=$("<li></li>").addClass(a);b(c);e.append(c);n()},n=function(){var a;a=0;$.each(e.children(),function(b,c){a+=$(c).outerHeight()});e.scrollTop(a)},p=function(){var a,b;a=g.val();b=i.val();""!==a.replace(/\s/g,"")&&(l(j,a,"#all"!==b),g.val(""),d.emit("chat",{to:b,text:a}))},i,g,q,e,d,j;i=$("#chat-to");g=$("#chat-input");q=$("#chat-send");e=$("#chat-log");n();if(j=prompt("Username:"))d=io.connect("/"),d.on("chat",function(a){l(a.user,a.text,a.whisper)}),d.on("login",function(a){k(a);
i.append("<option value='"+a+"'>"+a+"</option>")}),d.on("logout",function(a){m(a);i.find("[value="+a+"]").remove()}),d.on("logged in",function(a){$.each(a,function(a,c){"login"===c.type?k(c.user):"text"===c.type?l(c.user,c.text):"logout"===c.type&&m(c.user)});q.click(p);g.keypress(function(a){13===a.which&&p()});g.removeAttr("disabled");k(j)}),d.on("failed login",function(a){a=f("chat-reason",a);h("chat-fail",function(b){b.append("Failed to login: ").append(a)})}),d.emit("login",{user:j,count:e.children().length})});
